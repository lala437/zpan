(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14d2e418"],{"4da1":function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"topbar"},[r("el-input",{staticStyle:{width:"300px"},attrs:{size:"medium",placeholder:t.$t("admin.search-placeholder"),"prefix-icon":"el-icon-search"},on:{change:t.listRefresh},model:{value:t.query.email,callback:function(e){t.$set(t.query,"email",e)},expression:"query.email"}}),r("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"medium"},on:{click:t.createUser}},[t._v(t._s(t.$t("admin.btn-user-add")))])],1),r("el-card",{staticStyle:{"margin-top":"10px","padding-bottom":"20px"},attrs:{shadow:"never"}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.rows,size:"medium"}},[r("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),r("el-table-column",{attrs:{prop:"profile.nickname",label:t.$t("admin.label-nickname"),width:"120"}}),r("el-table-column",{attrs:{prop:"email",label:t.$t("admin.label-email")}}),r("el-table-column",{attrs:{prop:"role",label:t.$t("admin.label-role"),width:"120"}}),r("el-table-column",{attrs:{prop:"status",label:t.$t("admin.label-status"),width:"120"}}),r("el-table-column",{attrs:{prop:"storage",label:t.$t("admin.label-storage"),width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(e.row.storage.used.format())+" / "+t._s(e.row.storage.max.format()))])]}}])}),r("el-table-column",{attrs:{prop:"operation",label:t.$t("admin.label-operation"),width:"280"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{size:"mini"},on:{click:function(r){return t.onEditStorage(e.$index,e.row)}}},[t._v(t._s(t.$t("admin.btn-quota-update")))]),r("el-button",{attrs:{size:"mini"},on:{click:function(r){return t.onEditPassword(e.$index,e.row)}}},[t._v("修改密码")])]}}])})],1),r("div",{staticStyle:{"margin-top":"20px"}},[r("el-pagination",{staticStyle:{float:"right"},attrs:{layout:"prev, pager, next","current-page":t.pageNo,"page-size":t.query.limit,total:t.total},on:{"update:currentPage":function(e){t.pageNo=e},"update:current-page":function(e){t.pageNo=e},"current-change":t.listRefresh}})],1)],1)],1)},a=[],o=r("90fe"),i=r("6275"),l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:t.title,visible:t.visible,width:"35%"},on:{"update:visible":function(e){t.visible=e}}},[r("el-form",{ref:"form",staticStyle:{width:"85%"},attrs:{model:t.form,rules:t.rules}},[r("el-form-item",{attrs:{prop:"email",label:"邮箱","label-width":"100px"}},[r("el-input",{attrs:{placeholder:"电子邮箱",autofocus:""},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),r("el-form-item",{attrs:{prop:"role",label:"角色","label-width":"100px"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择用户角色"},model:{value:t.form.roles,callback:function(e){t.$set(t.form,"roles",e)},expression:"form.roles"}},t._l(t.roles,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),r("el-form-item",{attrs:{prop:"storage",label:"存储空间","label-width":"100px"}},[r("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请设置存储配额"},model:{value:t.form.storage,callback:function(e){t.$set(t.form,"storage",e)},expression:"form.storage"}},[r("el-select",{staticStyle:{width:"80px"},attrs:{slot:"append",placeholder:"单位"},slot:"append",model:{value:t.unitValue,callback:function(e){t.unitValue=e},expression:"unitValue"}},t._l(t.units,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1),r("el-form-item",{attrs:{prop:"password",label:"密码","label-width":"100px"}},[r("el-input",{attrs:{type:"password",placeholder:"密码"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),r("el-form-item",{attrs:{prop:"password2",label:"密码确认","label-width":"100px"}},[r("el-input",{attrs:{type:"password",placeholder:"密码确认"},model:{value:t.form.password2,callback:function(e){t.$set(t.form,"password2",e)},expression:"form.password2"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"medium"},on:{click:t.close}},[t._v(t._s(t.$t("cancel")))]),r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.submit}},[t._v(t._s(t.$t("confirm")))])],1)],1)},n=[],u=r("ebbf"),c={mixins:[u["b"]],props:{title:{type:String,default:""}},data:function(){var t=this,e=function(e,r,s){""===r?s(new Error("请输入密码")):(""!==t.form.password2&&t.$refs.form.validateField("password2"),s())},r=function(e,r,s){""===r?s(new Error("请再次输入密码")):r!==t.form.password?s(new Error("两次输入密码不一致!")):s()};return{roles:[{label:"管理员",value:"admin"},{label:"注册用户",value:"member"}],rules:{email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{validator:e,trigger:"blur",required:!0}],password2:[{validator:r,trigger:"blur",required:!0}]},unitValue:o["a"].bytesUnits()[2].value,form:{roles:"member",storage:100}}},computed:{units:function(){return o["a"].bytesUnits()}},methods:{submit:function(){var t=this;this.form.storage_max=Math.round(this.form.storage*this.unitValue),this.$zpan.User.signup(this.form).then((function(e){t.finish(),t.$message({type:"success",message:t.$t("msg.save-success")})}))}},mounted:function(){}},m=c,d=r("2877"),f=Object(d["a"])(m,l,n,!1,null,null,null),p=f.exports,b=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:t.$t("admin.label-quota-change"),visible:t.visible,width:"25%"},on:{"update:visible":function(e){t.visible=e}}},[r("el-form",{attrs:{model:t.form}},[r("el-form-item",{attrs:{label:t.$t("admin.label-quota"),"label-width":"110px"}},[r("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入内容"},model:{value:t.form.max.num,callback:function(e){t.$set(t.form.max,"num",e)},expression:"form.max.num"}},[r("el-select",{staticStyle:{width:"80px"},attrs:{slot:"append",placeholder:"单位"},slot:"append",model:{value:t.form.max.unitValue,callback:function(e){t.$set(t.form.max,"unitValue",e)},expression:"form.max.unitValue"}},t._l(t.units,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"medium"},on:{click:t.close}},[t._v(t._s(t.$t("cancel")))]),r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("confirm")))])],1)],1)},h=[],w={mixins:[u["b"]],props:{username:{type:String},form:{type:Object}},data:function(){return{}},computed:{units:function(){return o["a"].bytesUnits()}},methods:{onSubmit:function(){var t=this;this.form.max=Math.round(this.form.max.num*this.form.max.unitValue),this.$zpan.User.updateStorageByUser(this.username,this.form).then((function(e){t.finish(),t.$message({type:"success",message:t.$t("msg.save-success")})}))}},mounted:function(){}},v=w,g=Object(d["a"])(v,b,h,!1,null,null,null),y=g.exports,$=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:t.$t("admin.label-password-change"),visible:t.visible,width:"30%"},on:{"update:visible":function(e){t.visible=e}}},[r("el-form",{ref:"form",staticClass:"profile",staticStyle:{width:"85%"},attrs:{model:t.form,rules:t.rules,size:"medium","label-width":"100px"}},[r("el-form-item",{attrs:{label:"旧密码",prop:"old_password"}},[r("el-input",{attrs:{type:"password"},model:{value:t.form.old_password,callback:function(e){t.$set(t.form,"old_password",e)},expression:"form.old_password"}})],1),r("el-form-item",{attrs:{label:"新密码",prop:"new_password"}},[r("el-input",{attrs:{type:"password"},model:{value:t.form.new_password,callback:function(e){t.$set(t.form,"new_password",e)},expression:"form.new_password"}})],1),r("el-form-item",{attrs:{label:"密码确认",prop:"new_passwordr"}},[r("el-input",{attrs:{type:"password"},model:{value:t.form.new_passwordr,callback:function(e){t.$set(t.form,"new_passwordr",e)},expression:"form.new_passwordr"}})],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"medium"},on:{click:t.close}},[t._v(t._s(t.$t("cancel")))]),r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(e){return t.submit("form")}}},[t._v(t._s(t.$t("confirm")))])],1)],1)},_=[],x=(r("7f7f"),{mixins:[u["b"]],props:{username:{type:String}},data:function(){var t=this,e=function(e,r,s){""===r?s(new Error("请输入密码")):(""!==t.form.new_passwordr&&t.$refs.form.validateField("new_passwordr"),s())},r=function(e,r,s){""===r?s(new Error("请再次输入密码")):r!==t.form.new_password?s(new Error("两次输入密码不一致!")):s()};return{form:{},rules:{old_password:[{trigger:"blur",required:!0,message:"请输入当前密码"}],new_password:[{trigger:"blur",required:!0,validator:e}],new_passwordr:[{trigger:"blur",required:!0,validator:r}]}}},methods:{submit:function(t){var e=this;this.$refs[t].validate((function(t){t&&e.$zpan.User.updatePasswordByUser(e.username,e.form).then((function(t){e.finish(),e.$message({type:"success",message:"修改成功!"})}))}))}}}),k=x,S=Object(d["a"])(k,$,_,!1,null,null,null),q=S.exports,z={data:function(){return{query:{email:"",offset:0,limit:20},pageNo:1,rows:[],total:0}},methods:{listRefresh:function(){var t=this;this.query.offset=(this.pageNo-1)*this.query.limit,this.$zpan.User.list(this.query).then((function(e){t.rows=e.data.list.map((function(t){return t.storage.used=o["a"].formatBytes2(t.storage.used),t.storage.max=o["a"].formatBytes2(t.storage.max),t})),t.total=e.data.total}))},createUser:function(){var t=this;Object(i["a"])(p)({title:"添加用户"}).then((function(e){t.listRefresh()}))},onEditStorage:function(t,e){var r=this,s=Object.assign({},e.storage),a={username:e.username,form:s};Object(i["a"])(y)(a).then((function(){r.listRefresh()}))},onEditPassword:function(t,e){var r=this;Object(i["a"])(q)({username:e.username}).then((function(t){r.listRefresh()}))}},mounted:function(){this.listRefresh()}},E=z,U=(r("660f"),Object(d["a"])(E,s,a,!1,null,null,null));e["default"]=U.exports},6275:function(t,e,r){"use strict";r.d(e,"a",(function(){return l}));var s=r("a026"),a=r("9225"),o=r("c0d6"),i=r("41cb"),l=function(t){var e=s["default"].extend(t);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log(t);var r=new e({i18n:a["a"],store:o["a"],router:i["a"],propsData:t}).$mount(document.createElement("div"));return new Promise((function(t,e){r.$once("completed",(function(e){return t(e)})),r.$once("cancel",(function(t){return e(t)}))}))}}},"660f":function(t,e,r){"use strict";r("c0ba")},c0ba:function(t,e,r){},ebbf:function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return i}));r("7f7f"),r("ac6a");var s={data:function(){return{cs:{}}},watch:{$route:function(t,e){this.setCs()}},computed:{},methods:{setCs:function(){var t=this;this.$store.state.storages.forEach((function(e){e.name==t.$route.params.sname&&(t.cs=e)}))},getSid:function(){return this.cs.id}},mounted:function(){this.setCs()}},a=s,o={data:function(){return{visible:!1}},watch:{visible:function(t){!t&&this.$destroy()}},mounted:function(){document.body.appendChild(this.$el),this.visible=!0},destroyed:function(){this.$el.parentNode.removeChild(this.$el)},methods:{open:function(){this.visible=!0},close:function(){this.visible=!1},finish:function(){this.visible=!1,this.$emit("completed")}}},i=o}}]);
//# sourceMappingURL=chunk-14d2e418.7cd057ad.js.map